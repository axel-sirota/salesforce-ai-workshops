%%{init: {'theme': 'base', 'themeVariables': { 'primaryColor': '#e8f5e9', 'primaryTextColor': '#1b5e20', 'primaryBorderColor': '#388e3c', 'lineColor': '#388e3c', 'secondaryColor': '#e3f2fd', 'tertiaryColor': '#f3e5f5'}}}%%
flowchart TB
    subgraph Input["Input"]
        TEXT["Raw Text<br/>'My SSN is 123-45-6789<br/>and email john@co.com'"]
    end

    subgraph Analyzer["Presidio AnalyzerEngine"]
        direction TB
        subgraph Recognizers["Recognizer Pipeline"]
            direction LR
            REG["Regex<br/>Recognizers<br/>(SSN, phone,<br/>credit card)"]
            NER["NER<br/>Recognizers<br/>(spaCy model<br/>for names)"]
            CHK["Checksum<br/>Recognizers<br/>(credit card<br/>Luhn check)"]
            CTX["Context<br/>Enhancement<br/>(nearby keywords<br/>boost score)"]
        end
        MERGE["Merge & Deduplicate<br/>Results"]
        Recognizers --> MERGE
    end

    subgraph Results["Detection Results"]
        direction TB
        R1["SSN_NUMBER<br/>score: 0.85<br/>pos: 10-21"]
        R2["EMAIL_ADDRESS<br/>score: 0.95<br/>pos: 32-44"]
    end

    subgraph Anonymizer["Presidio AnonymizerEngine"]
        direction TB
        A1["Replace: 'My SSN is &lt;SSN_NUMBER&gt;'"]
        A2["Hash: 'My SSN is a1b2c3d4'"]
        A3["Mask: 'My SSN is ***-**-****'"]
    end

    TEXT --> Analyzer
    MERGE --> Results
    Results --> Anonymizer

    style Analyzer fill:#e8f5e9,stroke:#388e3c,stroke-width:2px
    style REG fill:#c8e6c9,stroke:#2e7d32
    style NER fill:#bbdefb,stroke:#1976d2
    style CHK fill:#d1c4e9,stroke:#7b1fa2
    style CTX fill:#ffe0b2,stroke:#f57c00
    style Results fill:#fff3e0,stroke:#f57c00,stroke-width:2px
    style Anonymizer fill:#e3f2fd,stroke:#1976d2,stroke-width:2px
